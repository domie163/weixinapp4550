(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shujixinxi/add-or-update"],{"0254":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r,n,i,u,a){try{var s=e[u](a),c=s.value}catch(o){return void r(o)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){u(a,n,i,s,c,"next",e)}function c(e){u(a,n,i,s,c,"throw",e)}s(void 0)}))}}var s=function(){Promise.all([r.e("common/vendor"),r.e("components/w-picker/w-picker")]).then(function(){return resolve(r("fdf1"))}.bind(null,r)).catch(r.oe)},c={data:function(){return{cross:"",ruleForm:{shujimingcheng:"",shujifenlei:"",tupian:"",zuozhe:"",chubanshe:"",shujijianjie:"",price:"",onelimittimes:"",alllimittimes:""},shujifenleiOptions:[],shujifenleiIndex:0,user:{},ro:{shujimingcheng:!1,shujifenlei:!1,tupian:!1,zuozhe:!1,chubanshe:!1,shujijianjie:!1,clicktime:!1,clicknum:!1,price:!1,onelimittimes:!1,alllimittimes:!1}}},components:{wPicker:s},computed:{baseUrl:function(){return this.$base.url}},onLoad:function(t){var r=this;return a(n.default.mark((function i(){var u,a,s,c;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return u=e.getStorageSync("nowTable"),i.next=3,r.$api.session(u);case 3:return a=i.sent,r.user=a.data,i.next=7,r.$api.option("shujifenlei","shujifenlei",{});case 7:if(a=i.sent,r.shujifenleiOptions=a.data,r.ruleForm.userid=e.getStorageSync("userid"),t.refid&&(r.ruleForm.refid=t.refid,r.ruleForm.nickname=e.getStorageSync("nickname")),!t.id){i.next=17;break}return r.ruleForm.id=t.id,i.next=15,r.$api.info("shujixinxi",r.ruleForm.id);case 15:a=i.sent,r.ruleForm=a.data;case 17:if(r.cross=t.cross,!t.cross){i.next=69;break}s=e.getStorageSync("crossObj"),i.t0=n.default.keys(s);case 21:if((i.t1=i.t0()).done){i.next=69;break}if(c=i.t1.value,"shujimingcheng"!=c){i.next=27;break}return r.ruleForm.shujimingcheng=s[c],r.ro.shujimingcheng=!0,i.abrupt("continue",21);case 27:if("shujifenlei"!=c){i.next=31;break}return r.ruleForm.shujifenlei=s[c],r.ro.shujifenlei=!0,i.abrupt("continue",21);case 31:if("tupian"!=c){i.next=35;break}return r.ruleForm.tupian=s[c],r.ro.tupian=!0,i.abrupt("continue",21);case 35:if("zuozhe"!=c){i.next=39;break}return r.ruleForm.zuozhe=s[c],r.ro.zuozhe=!0,i.abrupt("continue",21);case 39:if("chubanshe"!=c){i.next=43;break}return r.ruleForm.chubanshe=s[c],r.ro.chubanshe=!0,i.abrupt("continue",21);case 43:if("shujijianjie"!=c){i.next=47;break}return r.ruleForm.shujijianjie=s[c],r.ro.shujijianjie=!0,i.abrupt("continue",21);case 47:if("clicktime"!=c){i.next=51;break}return r.ruleForm.clicktime=s[c],r.ro.clicktime=!0,i.abrupt("continue",21);case 51:if("clicknum"!=c){i.next=55;break}return r.ruleForm.clicknum=s[c],r.ro.clicknum=!0,i.abrupt("continue",21);case 55:if("price"!=c){i.next=59;break}return r.ruleForm.price=s[c],r.ro.price=!0,i.abrupt("continue",21);case 59:if("onelimittimes"!=c){i.next=63;break}return r.ruleForm.onelimittimes=s[c],r.ro.onelimittimes=!0,i.abrupt("continue",21);case 63:if("alllimittimes"!=c){i.next=67;break}return r.ruleForm.alllimittimes=s[c],r.ro.alllimittimes=!0,i.abrupt("continue",21);case 67:i.next=21;break;case 69:r.styleChange();case 70:case"end":return i.stop()}}),i)})))()},methods:{styleChange:function(){this.$nextTick((function(){}))},clicktimeConfirm:function(e){console.log(e),this.ruleForm.clicktime=e.result,this.$forceUpdate()},shujifenleiChange:function(e){this.shujifenleiIndex=e.target.value,this.ruleForm.shujifenlei=this.shujifenleiOptions[this.shujifenleiIndex]},tupianTap:function(){var e=this;this.$api.upload((function(t){e.ruleForm.tupian="upload/"+t.file,e.$forceUpdate(),e.$nextTick((function(){e.styleChange()}))}))},getUUID:function(){return(new Date).getTime()},onSubmitTap:function(){var t=this;return a(n.default.mark((function r(){var i,u,a,s,c,o,l,m,f,h;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.ruleForm.shujimingcheng){r.next=3;break}return t.$utils.msg("书籍名称不能为空"),r.abrupt("return");case 3:if(t.ruleForm.shujifenlei){r.next=6;break}return t.$utils.msg("书籍分类不能为空"),r.abrupt("return");case 6:if(t.ruleForm.tupian){r.next=9;break}return t.$utils.msg("图片不能为空"),r.abrupt("return");case 9:if(!t.ruleForm.clicknum||t.$validate.isIntNumer(t.ruleForm.clicknum)){r.next=12;break}return t.$utils.msg("点击次数应输入整数"),r.abrupt("return");case 12:if(!t.ruleForm.price||t.$validate.isNumber(t.ruleForm.price)){r.next=15;break}return t.$utils.msg("价格应输入数字"),r.abrupt("return");case 15:if(!t.ruleForm.onelimittimes||t.$validate.isIntNumer(t.ruleForm.onelimittimes)){r.next=18;break}return t.$utils.msg("单限应输入整数"),r.abrupt("return");case 18:if(!t.ruleForm.alllimittimes||t.$validate.isIntNumer(t.ruleForm.alllimittimes)){r.next=21;break}return t.$utils.msg("库存应输入整数"),r.abrupt("return");case 21:if(!t.cross){r.next=37;break}if(s=e.getStorageSync("statusColumnName"),c=e.getStorageSync("statusColumnValue"),""==s){r.next=37;break}if(o=e.getStorageSync("crossObj"),s.startsWith("[")){r.next=33;break}for(l in o)l==s&&(o[l]=c);return m=e.getStorageSync("crossTable"),r.next=31,t.$api.update("".concat(m),o);case 31:r.next=37;break;case 33:i=Number(e.getStorageSync("userid")),u=o["id"],a=e.getStorageSync("statusColumnName"),a=a.replace(/\[/,"").replace(/\]/,"");case 37:if(!u||!i){r.next=59;break}return t.ruleForm.crossuserid=i,t.ruleForm.crossrefid=u,f={page:1,limit:10,crossuserid:i,crossrefid:u},r.next=43,t.$api.list("shujixinxi",f);case 43:if(h=r.sent,!(h.data.total>=a)){r.next=49;break}return t.$utils.msg(e.getStorageSync("tips")),r.abrupt("return",!1);case 49:if(!t.ruleForm.id){r.next=54;break}return r.next=52,t.$api.update("shujixinxi",t.ruleForm);case 52:r.next=56;break;case 54:return r.next=56,t.$api.add("shujixinxi",t.ruleForm);case 56:t.$utils.msgBack("提交成功");case 57:r.next=67;break;case 59:if(!t.ruleForm.id){r.next=64;break}return r.next=62,t.$api.update("shujixinxi",t.ruleForm);case 62:r.next=66;break;case 64:return r.next=66,t.$api.add("shujixinxi",t.ruleForm);case 66:t.$utils.msgBack("提交成功");case 67:case"end":return r.stop()}}),r)})))()},optionsChange:function(e){this.index=e.target.value},bindDateChange:function(e){this.date=e.target.value},getDate:function(e){var t=new Date,r=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return"start"===e?r-=60:"end"===e&&(r+=2),n=n>9?n:"0"+n,i=i>9?i:"0"+i,"".concat(r,"-").concat(n,"-").concat(i)},toggleTab:function(e){this.$refs[e].show()}}};t.default=c}).call(this,r("543d")["default"])},"0d1c":function(e,t,r){"use strict";var n=r("e70e"),i=r.n(n);i.a},"1cbc":function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return n}));var n={wPicker:function(){return Promise.all([r.e("common/vendor"),r.e("components/w-picker/w-picker")]).then(r.bind(null,"fdf1"))}},i=function(){var e=this,t=e.$createElement;e._self._c},u=[]},"5a49":function(e,t,r){"use strict";(function(e){r("3274");n(r("66fd"));var t=n(r("6b8a"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},"6b8a":function(e,t,r){"use strict";r.r(t);var n=r("1cbc"),i=r("9814");for(var u in i)"default"!==u&&function(e){r.d(t,e,(function(){return i[e]}))}(u);r("0d1c");var a,s=r("f0c5"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"678cc7a4",null,!1,n["a"],a);t["default"]=c.exports},9814:function(e,t,r){"use strict";r.r(t);var n=r("0254"),i=r.n(n);for(var u in n)"default"!==u&&function(e){r.d(t,e,(function(){return n[e]}))}(u);t["default"]=i.a},e70e:function(e,t,r){}},[["5a49","common/runtime","common/vendor"]]]);